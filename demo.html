<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>پلتفرم مدیریت گلخانه</title>
  <!-- Materialize CSS CDN -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
  <!-- Vazir Font CDN -->
  <link href="https://fonts.googleapis.com/css2?family=Vazir&display=swap" rel="stylesheet">
  <!-- Font Awesome CDN -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Vazir', sans-serif;
      background-color: #f5f5f5;
      direction: rtl;
      text-align: right;
      color: #333;
    }
    .navbar-fixed nav {
      background-color: #4caf50;
    }
    .nav-wrapper a {
      color: #ffffff;
    }
    .card {
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }
    .btn {
      background-color: #f28c38;
      border-radius: 10px;
      transition: background-color 0.3s, transform 0.3s;
    }
    .btn:hover {
      background-color: #e67e22;
      transform: scale(1.05);
    }
    .success-message {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #4caf50;
      color: #ffffff;
      padding: 15px;
      border-radius: 8px;
      opacity: 0;
      transition: opacity 0.5s;
      z-index: 1000;
    }
    .success-message.show {
      opacity: 1;
    }
    .recommendation {
      color: #0288d1;
      font-style: italic;
      margin-top: 10px;
    }
    .status-green { color: #4caf50; font-weight: bold; }
    .status-red { color: #d32f2f; font-weight: bold; }
    @media (max-width: 600px) {
      .container { padding: 0 10px; }
      .card { margin: 10px; }
      .btn { width: 100%; }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <div class="navbar-fixed">
    <nav>
      <div class="nav-wrapper">
        <a href="#" class="brand-logo right">مدیریت گلخانه</a>
        <ul class="left">
          <li><a href="#form-section">ثبت داده</a></li>
          <li><a href="#dashboard-section">داشبورد</a></li>
          <li><a href="#expert-section">تحلیل تخصصی</a></li>
        </ul>
      </div>
    </nav>
  </div>

  <!-- Form Section -->
  <section id="form-section" class="container section scrollspy">
    <div class="card">
      <div class="card-content">
        <h4>ثبت داده‌های گلخانه</h4>
        <form id="greenhouse-form">
          <div class="input-field">
            <input id="soil-ph" type="number" step="0.1" min="0" max="14" required>
            <label for="soil-ph">pH خاک</label>
          </div>
          <div class="input-field">
            <input id="temperature" type="number" step="0.1" min="-10" max="50" required>
            <label for="temperature">دما (°C)</label>
          </div>
          <div class="input-field">
            <input id="humidity" type="number" step="1" min="0" max="100" required>
            <label for="humidity">رطوبت (%)</label>
          </div>
          <div class="input-field">
            <select id="crop-type" required>
              <option value="" disabled selected>نوع محصول</option>
              <option value="گوجه‌فرنگی">گوجه‌فرنگی</option>
              <option value="خیار">خیار</option>
              <option value="فلفل">فلفل</option>
              <option value="کاهو">کاهو</option>
            </select>
            <label>نوع محصول</label>
          </div>
          <button type="submit" class="btn"><i class="fas fa-save left"></i>ثبت</button>
        </form>
        <div id="success-message" class="success-message">داده با موفقیت ثبت شد!</div>
      </div>
    </div>
  </section>

  <!-- Dashboard Section -->
  <section id="dashboard-section" class="container section scrollspy">
    <div class="card">
      <div class="card-content">
        <h4>داشبورد</h4>
        <div class="input-field">
          <select id="crop-filter">
            <option value="همه">همه</option>
            <option value="گوجه‌فرنگی">گوجه‌فرنگی</option>
            <option value="خیار">خیار</option>
            <option value="فلفل">فلفل</option>
            <option value="کاهو">کاهو</option>
          </select>
          <label>فیلتر بر اساس محصول</label>
        </div>
        <table class="highlight">
          <thead>
            <tr>
              <th>pH خاک</th>
              <th>دما (°C)</th>
              <th>رطوبت (%)</th>
              <th>نوع محصول</th>
              <th>زمان</th>
            </tr>
          </thead>
          <tbody id="data-table"></tbody>
        </table>
        <div class="row">
          <div class="col s12 m4">
            <canvas id="ph-chart"></canvas>
          </div>
          <div class="col s12 m4">
            <canvas id="temp-chart"></canvas>
          </div>
          <div class="col s12 m4">
            <canvas id="humidity-chart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Expert View Section -->
  <section id="expert-section" class="container section scrollspy">
    <div class="card">
      <div class="card-content">
        <h4>تحلیل تخصصی</h4>
        <table class="highlight">
          <thead>
            <tr>
              <th>pH خاک</th>
              <th>دما (°C)</th>
              <th>رطوبت (%)</th>
              <th>نوع محصول</th>
              <th>وضعیت</th>
              <th>توصیه‌ها</th>
            </tr>
          </thead>
          <tbody id="expert-table"></tbody>
        </table>
        <h5>ثبت توصیه دستی</h5>
        <form id="recommendation-form">
          <div class="input-field">
            <textarea id="recommendation-text" class="materialize-textarea" required></textarea>
            <label for="recommendation-text">توصیه</label>
          </div>
          <button type="submit" class="btn"><i class="fas fa-save left"></i>ثبت توصیه</button>
        </form>
        <h5>توصیه‌های دستی</h5>
        <ul id="manual-recommendations" class="collection"></ul>
      </div>
    </div>
  </section>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script>
    // Initialize Materialize components
    document.addEventListener('DOMContentLoaded', function() {
      M.FormSelect.init(document.querySelectorAll('select'));
      M.ScrollSpy.init(document.querySelectorAll('.scrollspy'));
    });

    // Sample data
    let greenhouseData = [
      { id: 1, soilPh: 6.5, temperature: 25, humidity: 60, cropType: "گوجه‌فرنگی", timestamp: "2025-06-04T07:00:00" },
      { id: 2, soilPh: 5.5, temperature: 18, humidity: 90, cropType: "گوجه‌فرنگی", timestamp: "2025-06-05T08:00:00" }
    ];
    let manualRecommendations = [];
    let nextId = 3;

    // Crop ranges for analysis
    const cropRanges = {
      "گوجه‌فرنگی": { ph: [6.0, 6.8], temp: [18, 30], humidity: [60, 80] },
      "خیار": { ph: [5.5, 6.5], temp: [20, 30], humidity: [70, 90] },
      "فلفل": { ph: [6.0, 7.0], temp: [21, 29], humidity: [65, 85] },
      "کاهو": { ph: [6.0, 7.0], temp: [15, 25], humidity: [50, 70] }
    };

    // Form submission
    document.getElementById('greenhouse-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const soilPh = parseFloat(document.getElementById('soil-ph').value);
      const temperature = parseFloat(document.getElementById('temperature').value);
      const humidity = parseFloat(document.getElementById('humidity').value);
      const cropType = document.getElementById('crop-type').value;

      // Validation
      if (soilPh < 0 || soilPh > 14 || temperature < -10 || temperature > 50 || humidity < 0 || humidity > 100 || !cropType) {
        alert('لطفاً مقادیر معتبر وارد کنید!');
        return;
      }

      // Add data
      greenhouseData.push({
        id: nextId++,
        soilPh,
        temperature,
        humidity,
        cropType,
        timestamp: new Date().toISOString()
      });

      // Reset form
      this.reset();
      M.FormSelect.init(document.querySelectorAll('select'));
      
      // Show success message
      const successMessage = document.getElementById('success-message');
      successMessage.classList.add('show');
      setTimeout(() => successMessage.classList.remove('show'), 3000);

      // Update UI
      updateDashboard();
      updateExpertView();
    });

    // Recommendation form submission
    document.getElementById('recommendation-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const text = document.getElementById('recommendation-text').value;
      manualRecommendations.push({ text, timestamp: new Date().toISOString() });
      this.reset();
      updateManualRecommendations();
    });

    // Filter data
    document.getElementById('crop-filter').addEventListener('change', function() {
      updateDashboard();
    });

    // Update dashboard
    function updateDashboard() {
      const filter = document.getElementById('crop-filter').value;
      const filteredData = filter === 'همه' ? greenhouseData : greenhouseData.filter(d => d.cropType === filter);

      // Update table
      const tableBody = document.getElementById('data-table');
      tableBody.innerHTML = filteredData.map(d => `
        <tr>
          <td>${d.soilPh}</td>
          <td>${d.temperature}</td>
          <td>${d.humidity}</td>
          <td>${d.cropType}</td>
          <td>${new Date(d.timestamp).toLocaleString('fa-IR')}</td>
        </tr>
      `).join('');

      // Update charts
      updateChart('ph-chart', filteredData, 'soilPh', 'pH خاک', '#4caf50');
      updateChart('temp-chart', filteredData, 'temperature', 'دما (°C)', '#f28c38');
      updateChart('humidity-chart', filteredData, 'humidity', 'رطوبت (%)', '#0288d1');
    }

    // Update chart
    function updateChart(canvasId, data, key, label, color) {
      const ctx = document.getElementById(canvasId).getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.map(d => new Date(d.timestamp).toLocaleTimeString('fa-IR')),
          datasets: [{
            label,
            data: data.map(d => d[key]),
            borderColor: color,
            fill: false
          }]
        },
        options: {
          responsive: true,
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    // Update expert view
    function updateExpertView() {
      const tableBody = document.getElementById('expert-table');
      tableBody.innerHTML = greenhouseData.map(d => {
        const ranges = cropRanges[d.cropType];
        const phStatus = d.soilPh >= ranges.ph[0] && d.soilPh <= ranges.ph[1] ? 'status-green' : 'status-red';
        const tempStatus = d.temperature >= ranges.temp[0] && d.temperature <= ranges.temp[1] ? 'status-green' : 'status-red';
        const humidityStatus = d.humidity >= ranges.humidity[0] && d.humidity <= ranges.humidity[1] ? 'status-green' : 'status-red';
        const recommendations = [];
        if (d.soilPh < ranges.ph[0]) recommendations.push('اضافه کردن آهک برای کاهش اسیدیته خاک');
        if (d.soilPh > ranges.ph[1]) recommendations.push('اضافه کردن گوگرد برای کاهش قلیاییت خاک');
        if (d.temperature < ranges.temp[0]) recommendations.push('افزایش دمای گلخانه');
        if (d.temperature > ranges.temp[1]) recommendations.push('کاهش دمای گلخانه');
        if (d.humidity < ranges.humidity[0]) recommendations.push('افزایش رطوبت گلخانه');
        if (d.humidity > ranges.humidity[1]) recommendations.push('کاهش رطوبت گلخانه');

        return `
          <tr>
            <td>${d.soilPh}</td>
            <td>${d.temperature}</td>
            <td>${d.humidity}</td>
            <td>${d.cropType}</td>
            <td>
              <span class="${phStatus}">pH: ${d.soilPh >= ranges.ph[0] && d.soilPh <= ranges.ph[1] ? 'مناسب' : 'نامناسب'}</span><br>
              <span class="${tempStatus}">دما: ${d.temperature >= ranges.temp[0] && d.temperature <= ranges.temp[1] ? 'مناسب' : 'نامناسب'}</span><br>
              <span class="${humidityStatus}">رطوبت: ${d.humidity >= ranges.humidity[0] && d.humidity <= ranges.humidity[1] ? 'مناسب' : 'نامناسب'}</span>
            </td>
            <td>${recommendations.map(r => `<div class="recommendation">${r}</div>`).join('')}</td>
          </tr>
        `;
      }).join('');
    }

    // Update manual recommendations
    function updateManualRecommendations() {
      const list = document.getElementById('manual-recommendations');
      list.innerHTML = manualRecommendations.map(r => `
        <li class="collection-item">
          ${r.text} <br><small>${new Date(r.timestamp).toLocaleString('fa-IR')}</small>
        </li>
      `).join('');
    }

    // Initialize
    updateDashboard();
    updateExpertView();
    updateManualRecommendations();
  </script>
</body>
</html>